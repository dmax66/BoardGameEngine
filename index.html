<!DOCTYPE html>
 <html>
 <meta charset="utf-8"/>


<style>
.title_area { grid-area: header; }
.menu_area { grid-area: menu; }
.main_area { grid-area: main; }
.right_area { grid-area: right; }
.footer_area { grid-area: footer; }

.grid-container {
  display: grid;
  grid-template-areas:
    'menu header header header header header header header'
    'menu main main main main main main right'
    'footer footer footer footer footer footer footer footer';
  grid-gap: 20px;
  background-color: black;
  padding: 20px;
  grid-column-gap: 50px;
  grid-row-gap: 50px;
}

.grid-container > div {
  background-color: rgba(0, 0, 0, 0.8);
  text-align: center;
  padding: 20px 0;
  font-size: 30px;
}

.position-tracker {
  position: fixed;
  bottom: 0;
  right: 0;
  width: 50px;
  height: 35px;
  z-index: 2;
  background-color: black;
  color: white;
  font-size: 10px;
  font-family: Arial, Helvetica, sans-serif;
}
  

.container {
  width: 4474px;
  height: 2791px;
  position: absolute;
  left: 0px;
  top: 0px;
}

.container .img {
  height: auto;
  position: absolute;
  left: 0px;
  top: 0px;
}

.counter-widget {
  position: absolute;
  width: 60px;
  height: 26px;
  padding: 0px 0px;
  border: none;
  cursor: pointer;
  border-radius: 0px;
  text-align: center;
  font-size: 10px;
  font-family: Times, Roman, serif;
  background-repeat: no-repeat;
  background-color: transparent;
}

.counter-widget:hover {
  border-top: 5px; 
  border-left: 5px; 
  border-right: 5px; 
  border-bottom: 5px; 
  border-color: rgba(239, 0, 0, 0.4); 
  border-style: solid; 
  border-radius: 8px 8px 8px 8px; 
  box-shadow: -2px 19px 25px 0px rgba(76, 0, 0, 1.0); 
  -webkit-box-shadow: -2px 19px 25px 0px rgba(76, 0, 0, 1.0); 
}


.counter-icon {
  position: absolute;
  left: 0px;
  top: 0px;
  z-index: 0;
}

.counter-name {
  position: absolute;
  left: 0px;
  top: 0px;
  width: 60px;
  height: 10px;
  z-index: 1;
  text-align: center;
  font-size: 10px;
  font-family: Times, Roman, serif;
  color: black;
}  
  
.leader-info {
  position: absolute;
  color: black;
  background-color: #efdf88;
  min-width: 2px;
  min-height: 2px;
  font-size: 14px;
  font-weight: bold;
  padding: 15px 15px 15px 15px; 
  border-top: 1px; 
  border-left: 1px; 
  border-right: 1px; 
  border-bottom: 1px;   
  border-color: rgba(0, 0, 0, 1.0); 
  border-style: double; 
  border-radius: 8px; 
  cursor: pointer;
  text-align: left;
  background-repeat: no-repeat;
  box-shadow:7px 5px 7px #555555;
  border-radius: 5px;
  z-index: 1;
  width: 200px;
}
  
.leader-table {
  text-align: left;
  font-size: 12px;
  font-family: Times, Roman, serif;
  font-weight: normal;
}

.leader-table tr {
    border-bottom: 1px solid #aaa;
}
  
.leader-table tr:hover {
    background-color: #A0A0A0;
}
  
  
  
.unit-info {
  position: absolute;
  color: black;
  background-color: #efdf88;
  min-width: 200px;
  min-height: 10px;
  padding: 1px 1px;
  cursor: pointer;
  text-align: left;
  font-size: 12px;
  font-family: Arial, Helvetica, sans-serif;
  background-repeat: no-repeat;
  box-shadow:7px 5px 7px #555555;
  border: 1px;
  border-radius: 5px;
  border-top: 1px solid #DDDDDD;
  border-left: 1px solid #DDDDDD;
  z-index: 1;
}
  
.unit-table {
  text-align: left;
  font-size: 10px;
  font-family: Arial, Helvetica, sans-serif;
  font-weight: normal;
  padding: 0px;
  border: 5px black;
}

.unit-table tr {
  border-bottom: 1px solid #aaa;
  padding: 0px;
  border: 5px black;
}
  
.unit-table tr:hover {
  background-color: #A0A0A0;
}

.unit-table td {
  padding: 0px;
  border: 0px;
}
  

.unit-icon {
}

.p {
  background-color: #9494b8;
  color: white;
}
  
.a {
  background-color: #e6e6e6;
  color: black;
}

.r {
	background-color: #9fdf9f;
  color: black;
}
	
.f {
	background-color: #66c2ff; 
  color: black;
}  

.s {
	background-color: #ff66b3; 
  color: white;
}

.g {
  background-color: yellow;
  color: black;
}

.generic {
  background-color: Gray;
  color: black;
}
  
.cavalry-leader {
  background-image: url("img/cavalry-line.png");
}

.infantry-leader {
  background-image: url("img//infantry-line.png");
}

.cop-counter {
  background-image: url("img/center-operations.png");
}

.supply-counter {
  background-image:url("img/active-supply.png");
}

.bridge-counter {
  background-image: url ("img/bridge-train.png");
}

.cavalry-unit-division {
  background-image: url ("img/Cavalry-Division.png");
}

.infantry-unit-division {
  background-image: url ("img//Infantry-Division.png");
}

.artillery-unit {
background-image: url ("img/Artillery-Division.png")
;}

/* Dropdown Content (Hidden by Default) */
.unitInfoWidget-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}


.btn-minus
{
  position: block;
  background-color: #efdf88;  
  color: black;
  border-color: black;
  border-radius: 10px 0px 0px 10px; 
  height: 22px;
  width: 8px;
  font-size: 10px;
  font-family: Arial, Helvetica, sans-serif;
}
  
.btn-plus
{
  position: block;
  background-color: #efdf88;  
  color: black;
  border-color: black;
  border-radius: 0px 10px 10px 0px; 
  height: 22px;
  width: 8px;
  font-size: 10px;
  font-family: Arial, Helvetica, sans-serif;
}
  
.strength-box
{
  position: block;
  background-color: #efdf88;  
  color: black;
  border-color: black;
  border-radius: 0px; 
  height: 15px;
  width: 16px;
  font-size: 10px;
  font-family: Arial, Helvetica, sans-serif;
}
  
  



/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 10; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 400px; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}


.status_bar {
  position: fixed;
  width: 100%;
  top: 0px;
  left: 0px;
  height: 30px;  
  background-color: black;
  z-index: 1;
}


.menu_symbol {
  font-size: 15px;
  color: silver; 
  background-color: black;
  height: 30px;
}

.menu_symbol:hover {
  background-color: silver;
  color: black;
  cursor: default;
}



.main_menu {
  position: fixed;
  font-size:15px;
  color:silver; 
  background-color: black;
  top: 30px;
  width: 200px;
  cursor: default;
  visibility: hidden;
  z-index: 2;
}

.menu_item {
  font-size: 15px;
  color:silver; 
  background-color: black;
  cursor: default;
}

.menu_item:hover, .menu_item:focus {
  font-size:15px;
  color: black; 
  background-color: silver;
}

.game_map {
  position: absolute;
  top: 30px;
  vertical-align: 100px;
  z-index: 0;
  overflow: scroll;
}

.indicators {
  font-size:15px;
}

.pos_tracker {
  position: fixed;
  width: 100px;
  top: 0px;
  right: 0;
  height: 30px;  
  background-color: black;
  color: white;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 8px;
  z-index: 1;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

.close-icon {
  position: relative;
  float: right;
  right: -20px;
  top: -20px;
}
</style>

<script src="common.js"></script>
<script src="map_geometry_funcs.js"></script>
<script src="game.js"></script>
<script src="leaders.js"></script>
<script src="units.js"></script>
<script src="wargame_ui.js"></script>





<script type="text/javascript">

let new_game_id = '';


// 
// USER INTERFACE MANAGEMENT FUNCTIONS 
//
function createNewGameDialog () {
  // Open a pop up menu to ask: game name, scenario
  document.getElementById("newgame_box").style.display = "block";   
  
  // Load the list of scenarios
  call_server_api_get ("app/get_scenarios.php", populate_scenario_list);
}


function populate_scenario_list(xhttp_obj) {
  const scenarios = JSON.parse(xhttp_obj.responseText); 

  const scenario_list = document.getElementById("scenario_list");

  for (let i=0; i < scenarios.length; i++)
  {
    let new_elem = document.createElement ("option");
    new_elem.value = scenarios[i].id;
    new_elem.innerHTML = scenarios[i].name;

    scenario_list.appendChild (new_elem);
  }
}


function createLoadGameDialog () {
 // Open a pop up menu to select game to load
  document.getElementById("loadgame_box").style.display = "block";   
  
  // Load the list of scenarios
  call_server_api_get ("app/get_games.php", populate_game_list);
}


function populate_game_list(xhttp_obj) {
  const games = JSON.parse(xhttp_obj.responseText); 

  const game_list = document.getElementById("game_list");

  for (let i=0; i < games.length; i++)
  {
    let new_elem = document.createElement ("option");
    new_elem.value = games[i].ID;
    new_elem.innerHTML = games[i].Name + " (Scenario: " + games[i].Description + ")";

    game_list.appendChild (new_elem);
  }
}


function load_game_data (game_id) {
  call_server_api_get ("app/load_game.php?game_id=" + game_id, createGame);
  call_server_api_get ("app/load_leaders.php?game_id=" + game_id, createLeaders);
  call_server_api_get ("app/load_units.php?game_id=" + game_id, createUnits);
}


function beginGame() {
  // Initialise admin points, morale, reinforcement points
  frenchPlayerStatus.setAdminPoints         (game.FrenchAdminPoints);
  frenchPlayerStatus.setMorale              (game.FrenchMorale);
  frenchPlayerStatus.setReinforcementPoints (game.FrenchReinforcementPoints);

  alliedPlayerStatus.setAdminPoints         (game.ArmyOfSilesiaAdminPoints);
  alliedPlayerStatus.setMorale              (game.AlliedMorale);
  alliedPlayerStatus.setReinforcementPoints (game.PrussianReinforcementPoints);

  frenchPlayerStatus.drawSelf();

  for (i=0; i < leaders.length; i++) {
    leaders[i].drawSelf();
  }
}





function get_scenario_data (xhttp_obj)
{
   const json_response = JSON.parse (xhttp_obj.responseText);
   
   scenario_data = json_response[0];
}


function do_nothing()
{
}


function get_game_id (xhttp_obj)
{
  new_game_id = xhttp_obj.responseText;
}


function init_game_from_scenario(scenario_id, game_name)
{
 // Get scenario data from DB and populate internal structures
//  const url = "app/get_scenario_data.php?scenario_id=" + scenario_id;
//  call_server_api_get (url, get_scenario_data);

  // Create the new game in the database
  call_server_api_get ("app/create_game_from_scenario.php?scenario_id=" + scenario_id + "&game_name=" + game_name, get_game_id);
  
    
  load_game_data (new_game_id);

  // Close the load game modal box
  document.getElementById("newgame_box").style.display="none";
  
  // And get the game begin
  beginGame();
}


function load_game (game_id) {
  load_game_data (game_id);
  
  // Close the load game modal box
  document.getElementById("loadgame_box").style.display="none";
  
  // And get the game begin
  beginGame();  
}



function show_menu (flag) {
  var menu_obj = document.getElementById("main_menu_id");
  
  menu_obj.style.visibility = (flag == true) ? "visible" : "hidden";
}

function toggle_menu () {
  var menu_obj = document.getElementById("main_menu_id");
  
  menu_obj.style.visibility = (menu_obj.style.visibility != "visible") ? "visible" : "hidden";
}


function showMousePosition (ev)
{
  const x = xUnitCoordFromMapCoord (ev.offsetX, ev.offsetY);
  const y = yUnitCoordFromMapCoord (ev.offsetX, ev.offsetY);
  
  document.getElementById ("position-tracker").innerHTML = ev.offsetX + "," + ev.offsetY + "<br>" + x + ", " + y;
}




</script>


<body>


<font color="Silver">

<!-- New game modal box -->
<div id="newgame_box" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <label for="scenario_list"><h3>Select a scenario</h3></label>
    <select id="scenario_list" name="scenarios">
        <option value=""></option>
    </select> 
    <br>Enter the game name: <input type="text" id="game_name">
    <br><input type="button" value="Create Game" onclick="init_game_from_scenario (document.getElementById ('scenario_list').value, document.getElementById ('game_name').value)">
  </div>

</div>


<!-- Load game modal box -->
<div id="loadgame_box" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <label for="game_list"><h3>Select a game</h3></label>
    <select id="game_list" name="games">
    </select> 
    <br><input type="button" value="Load" onclick="load_game (document.getElementById ('game_list').value)">
  </div>

</div>


<!-- Main manu -->
<div id="main_menu_id" class="main_menu">
  <div id="menu_items_id" class="menu_items"> 
    <div id="new_game_entry" class="menu_item" onclick="createNewGameDialog();" >New Game</div>
    <div id="load_game_entry" class="menu_item" onclick="createLoadGameDialog();" >Load Game</div>
    <div id="quit_game_entry" class="menu_item">Quit Game</div>
  </div>
</div>


<!-- MAIN WINDOW -->
<div id="StatusBar" class="status_bar" >
  <span id="menu_symbol" class="menu_symbol" onclick="toggle_menu();" >&nbsp;&#9776;&nbsp; Main menu</span>
  <span>
    Turn:                  <input type="text" id="turn_id"                 class="indicators" readonly style="width:20px">
    Phase:                 <input type="text" id="phase_id"                class="indicators" readonly style="width:80px">
    Weather:               <input type="text" id="weather_id"              class="indicators" readonly style="width:50px">
    Player:                <input type="text" id="player_id"               class="indicators" readonly style="width:80px">
    Administrative Points: <input type="text" id="admin_points_id"         class="indicators" readonly style="width:20px">
    Reinforcement Points:  <input type="text" id="reinforcement_points_id" class="indicators" readonly style="width:20px">
    Morale:                <input type="text" id="morale_id"               class="indicators" readonly style="width:20px">
</div>

<div class="pos_tracker" id="position-tracker">
Position tracker
</div>

<div id="mapContainer">
<img id="game_map_id" class="game_map" src="img/SoN_Map_New-2011_0521.png" onclick="show_menu(false)" onmousemove="showMousePosition(event)">
</div>
 
</font>

<script>

// Get the <span> element that closes the modal
const close_button = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
close_button.onclick = function() {
  document.getElementById("newgame_box").style.display = "none";
}  
  
var newgame_box = document.getElementById("newgame_box");


</script>


</body>

</html>