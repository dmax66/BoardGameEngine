<!DOCTYPE html>
 <html>
 <meta charset="utf-8"/>


<style>
.title_area { grid-area: header; }
.menu_area { grid-area: menu; }
.main_area { grid-area: main; }
.right_area { grid-area: right; }
.footer_area { grid-area: footer; }

.grid-container {
  display: grid;
  grid-template-areas:
    'menu header header header header header header header'
    'menu main main main main main main right'
    'footer footer footer footer footer footer footer footer';
  grid-gap: 20px;
  background-color: black;
  padding: 20px;
  grid-column-gap: 50px;
  grid-row-gap: 50px;
}

.grid-container > div {
  background-color: rgba(0, 0, 0, 0.8);
  text-align: center;
  padding: 20px 0;
  font-size: 30px;
}


<style> 

body {font-family: Arial, Helvetica, sans-serif;}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 400px; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.game_ymap {
  position: absolute;
  top: 30px;
  left: 0px;
  overflow: scroll;
}

.status_bar {
  position: fixed;
  width: 100%;
  top: 0px;
  left: 0px;
  height: 30px;  
  background-color: black;
  z-index: 1;
}


.menu_symbol {
  font-size: 15px;
  color: silver; 
  background-color: black;
  height: 30px;
}

.menu_symbol:hover {
  background-color: silver;
  color: black;
  cursor: default;
}



.main_menu {
  position: fixed;
  font-size:15px;
  color:silver; 
  background-color: black;
  top: 30px;
  width: 200px;
  cursor: default;
  visibility: hidden;
  z-index: 2;
}

.menu_item {
  font-size: 15px;
  color:silver; 
  background-color: black;
  cursor: default;
}

.menu_item:hover, .menu_item:focus {
  font-size:15px;
  color: black; 
  background-color: silver;
}

.game_map {
  position: absolute;
  top: 30px;
  vertical-align: 100px;
  z-index: 0;
  overflow: scroll;
}

</style>

<script src="common.js"></script>
<script src="map_geometry_funcs.js"></script>
<script src="game.js"></script>
<script src="leaders.js"></script>
<script src="units.js"></script>





<script type="text/javascript">


// 
// USER INTERFACE MANAGEMENT FUNCTIONS 
//
function createNewGameDialog () {
  // Open a pop up menu to ask: game name, scenario
  document.getElementById("newgame_box").style.display = "block";   
  
  // Load the list of scenarios
  call_server_api_get ("app/get_scenarios.php", populate_scenario_list);
}


function populate_scenario_list(xhttp_obj) {
  const scenarios = JSON.parse(xhttp_obj.responseText); 

  const scenario_list = document.getElementById("scenario_list");

  for (let i=0; i < scenarios.length; i++)
  {
    let new_elem = document.createElement ("option");
    new_elem.value = scenarios[i].id;
    new_elem.innerHTML = scenarios[i].name;

    scenario_list.appendChild (new_elem);
  }
}


function createLoadGameDialog () {
 // Open a pop up menu to select game to load
  document.getElementById("loadgame_box").style.display = "block";   
  
  // Load the list of scenarios
  call_server_api_get ("app/get_games.php", populate_game_list);
}


function populate_game_list(xhttp_obj) {
  const games = JSON.parse(xhttp_obj.responseText); 

  const game_list = document.getElementById("game_list");

  for (let i=0; i < games.length; i++)
  {
    let new_elem = document.createElement ("option");
    new_elem.value = games[i].ID;
    new_elem.innerHTML = games[i].Name + " (Scenario: " + games[i].Description + ")";

    game_list.appendChild (new_elem);
  }
}







function load_game_data (game_id) {
  call_server_api_get ("app/load_game.php?game_id=" + game_id, createGame);
  call_server_api_get ("app/load_leaders.php?game_id=" + game_id, createLeaders);
  call_server_api_get ("app/load_units.php?game_id=" + game_id, createUnits);
}








function beginGame() {
  // Show the main map
  document.getElementById("mapContainer").src = "img/SoN_Map_New-2011_0521.png";

  // Initialise admin points, morale, reinforcement points
  frenchPlayerStatus.setAdminPoints         (game.FrenchAdminPoints);
  frenchPlayerStatus.setMorale              (game.FrenchMorale);
  frenchPlayerStatus.setReinforcementPoints (game.FrenchReinforcementPoints);

  alliedPlayerStatus.setAdminPoints         (game.ArmyOfSilesiaAdminPoints);
  alliedPlayerStatus.setMorale              (game.AlliedMorale);
  alliedPlayerStatus.setReinforcementPoints (game.PrussianReinforcementPoints);

  frenchPlayerStatus.drawSelf();

  for (i=0; i < leaders.length; i++) {
    leaders[i].drawSelf();
  }
}





function get_scenario_data (xhttp_obj)
{
   let json_response = JSON.parse (xhttp_obj.responseText);
   
   scenario_data = json_response[0];
}


function do_nothing()
{
}

let new_game_id = '';

function get_game_id (xhttp_obj)
{
  new_game_id = xhttp_obj.responseText;
}


function init_game_from_scenario(scenario_id, game_name)
{
 // Get scenario data from DB and populate internal structures
//  const url = "app/get_scenario_data.php?scenario_id=" + scenario_id;
//  call_server_api_get (url, get_scenario_data);

  // Create the new game in the database
  call_server_api_get ("app/create_game_from_scenario.php?scenario_id=" + scenario_id + "&game_name=" + game_name, get_game_id);
  
    
  load_game_data (new_game_id);

  // Close the load game modal box
  document.getElementById("newgame_box").style.display="none";
  
  // And get the game begin
  beginGame();
}


function load_game (game_id) {
  load_game_data (game_id);
  
  // Close the load game modal box
  document.getElementById("loadgame_box").style.display="none";
  
  // And get the game begin
  beginGame();  
}


</script>


<script type="text/javascript">


function show_menu (flag) {
  var menu_obj = document.getElementById("main_menu_id");
  
  menu_obj.style.visibility = (flag == true) ? "visible" : "hidden";
}

function toggle_menu () {
  var menu_obj = document.getElementById("main_menu_id");
  
  menu_obj.style.visibility = (menu_obj.style.visibility != "visible") ? "visible" : "hidden";
}

</script>


<body>


<font color="Silver">

<!-- New game modal box -->
<div id="newgame_box" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <label for="scenario_list"><h3>Select a scenario</h3></label>
    <select id="scenario_list" name="scenarios">
        <option value=""></option>
    </select> 
    <br>Enter the game name: <input type="text" id="game_name">
    <br><input type="button" value="Create Game" onclick="init_game_from_scenario (document.getElementById ('scenario_list').value, document.getElementById ('game_name').value)">
  </div>

</div>


<!-- Load game modal box -->
<div id="loadgame_box" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <label for="game_list"><h3>Select a game</h3></label>
    <select id="game_list" name="games">
    </select> 
    <br><input type="button" value="Load" onclick="load_game (document.getElementById ('game_list').value)">
  </div>

</div>


<!-- Main manu -->
<div id="main_menu_id" class="main_menu">
  <div id="menu_items_id" class="menu_items"> 
    <div id="new_game_entry" class="menu_item" onclick="createNewGameDialog();" >New Game</div>
    <div id="load_game_entry" class="menu_item" onclick="createLoadGameDialog();" >Load Game</div>
    <div id="quit_game_entry" class="menu_item">Quit Game</div>
  </div>
</div>


<!-- MAIN WINDOW -->
<div id="StatusBar" class="status_bar" >
  <span id="menu_symbol" class="menu_symbol" onclick="toggle_menu();" >&nbsp;&#9776;&nbsp; Main menu</span>
</div>

<img id="game_map_id" class="game_map" src="img/SoN_Map_New-2011_0521.png" onclick="show_menu(false)" > 
</font>

<script>

// Get the <span> element that closes the modal
const close_button = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
close_button.onclick = function() {
  document.getElementById("newgame_box").style.display = "none";
}  
  
var newgame_box = document.getElementById("newgame_box");


</script>


</body>

</html>